<ng-container *ngIf="data$ | async as data">
    <app-content [title]="data.label">
        <ng-template #content>
            <page-version-edit [id]="data.item.id"></page-version-edit>
        </ng-template>

        <ng-template #aside>
            <tabset>
                <tab>
                    <ng-template tabHeading>
                        <i class="icon-settings"></i>
                    </ng-template>
                    <div class="p-3">
                        <form [formGroup]="form" *ngIf="form">
                            <formly-form [form]="form" [fields]="fields" [model]="data.item"></formly-form>
                        </form>
                        <form [formGroup]="navigationForm" *ngIf="navigationForm">
                            <formly-form [form]="navigationForm" [fields]="navigationFields" [model]="navigationModel"></formly-form>
                        </form>
                    </div>
                </tab>
                <tab>
                    <ng-template tabHeading>
                        <i class="icon-wrench"></i>
                    </ng-template>
                    <div class="p-3">
                        <ng-container *ngIf="false">
                            <form [formGroup]="pageTypeForm" *ngIf="pageTypeForm" >
                                <formly-form [form]="pageTypeForm" [fields]="pageTypeFields" [model]="pageTypeModel"></formly-form>

                                <button type="button" class="btn btn-outline-success btn-sm" (click)="onChangePageTypeModal(changePageTypeModal)">Change Page Type</button>
                            </form>
                        </ng-container>
                        <ng-container *ngIf="data.meta.otherLanguages.length > 0">
                            <h6><i class="fa fa-fw fa-clone"></i> Replace Content</h6>
                            <ng-container *ngIf="data.meta.otherLanguages.length > 0">
                                <div><small><b>From other language</b></small></div>
                                <div class="row mb-3">
                                    <div class="col" *ngFor="let language of data.meta.otherLanguages">
                                        <a style="cursor: pointer;" (click)="onReplaceContentModal(replaceModal, language)">
                                            <i class="flag-icon flag-icon-{{ language.locale.substr(3) | lowercase }}"></i>
                                        </a>
                                    </div>
                                </div>
                            </ng-container>
                            <ng-container *ngIf="data.meta.samePageTypePages.length > 0">
                                <div><small><b>From other page</b></small></div>
                                <ng-select [items]="data.meta.samePageTypePages"
                                           (change)="onReplaceContentModal(replaceModal, $event)"
                                           bindLabel="name"
                                           [searchable]="true"
                                           [clearable]="false"
                                           bindValue="id">
                                </ng-select>
                            </ng-container>
                            <hr>
                        </ng-container>
                    </div>
                </tab>
            </tabset>
        </ng-template>

        <ng-template #header>
            <div class="btn-group btn-group-sm pull-right">
                <button type="button" class="btn btn-danger btn-sm" *ngIf="data.meta.hasChildren === false"
                        [disabled]="(loading$ | async)"
                        (click)="showDeleteModal(deleteModal)">
                    <i class="fa fa-trash"></i> Delete
                </button>
                <button type="button" class="btn btn-outline-danger btn-sm" *ngIf="data.meta.hasChildren" popover="Can't delete pages with children!" placement="bottom">
                    <i class="fa fa-trash"></i> Delete
                </button>
                <button type="button" (click)="onSubmit()" class="btn btn-primary btn-sm">
                    <i class="fa fa-fw fa-save"></i>
                    <span>Publish</span>
                </button>
            </div>
        </ng-template>
    </app-content>
    <ng-template #deleteModal>
        <div class="modal-header">
            <h4 class="modal-title pull-left">Delete</h4>
            <button type="button" class="close pull-right" aria-label="Close" (click)="modalRef.hide()">
                <span aria-hidden="true">&times;</span>
            </button>
        </div>
        <div class="modal-body">
            You really want to delete this page?
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-primary" (click)="onDelete()">Delete</button>
            <button type="button" class="btn btn-secondary" (click)="modalRef.hide()">Cancel</button>
        </div>
    </ng-template>


    <ng-template #changePageTypeModal>
        <div class="modal-header">
            <h4 class="modal-title pull-left">Page Type</h4>
            <button type="button" class="close pull-right" aria-label="Close" (click)="modalRef.hide()">
                <span aria-hidden="true">&times;</span>
            </button>
        </div>
        <div class="modal-body">
            You really want to change the page type? All entered data will be lost!
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-primary" (click)="changePageType()">Change</button>
            <button type="button" class="btn btn-secondary" (click)="modalRef.hide()">Cancel</button>
        </div>
    </ng-template>

    <ng-template #replaceModal>
        <div class="modal-header">
            <h4 class="modal-title pull-left">Replace Content</h4>
            <button type="button" class="close pull-right" aria-label="Close" (click)="modalRef.hide()">
                <span aria-hidden="true">&times;</span>
            </button>
        </div>
        <div class="modal-body">
            You really want to replace this page content with the content of page <i>{{ replacePage.name }}</i>(<i class="flag-icon flag-icon-{{ replacePage.locale.substr(3) | lowercase }}"></i>)? All current entered data will be lost!
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-primary" (click)="onReplaceContent(data.item.id)">Replace</button>
            <button type="button" class="btn btn-secondary" (click)="modalRef.hide();replacePage = null;">Cancel</button>
        </div>
    </ng-template>

</ng-container>

